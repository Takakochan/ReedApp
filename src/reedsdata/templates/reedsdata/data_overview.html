{% extends 'base.html' %}
{% block title %}Data Overview{% endblock title %}
{% block content %}

<div class="bg-white rounded-xl shadow-2xl p-8">
    <h2 class="text-2xl font-bold text-center text-indigo-800 mb-6">Data Overview</h2>

    <!-- Statistics Dashboard -->
    <div class="mb-8">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">Statistics Dashboard</h3>

        <!-- Total Reeds and Recent Activity -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-indigo-50 border-l-4 border-indigo-300 p-6 rounded">
                <h4 class="text-lg font-semibold text-indigo-900 mb-2">Total Reeds</h4>
                <p class="text-3xl font-bold text-indigo-800">{{ total_reeds }}</p>
            </div>

            <div class="bg-green-50 border-l-4 border-green-300 p-6 rounded">
                <h4 class="text-lg font-semibold text-green-900 mb-2">Last 7 Days</h4>
                <p class="text-3xl font-bold text-green-800">{{ last_7_days }}</p>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-300 p-6 rounded">
                <h4 class="text-lg font-semibold text-blue-900 mb-2">Last 30 Days</h4>
                <p class="text-3xl font-bold text-blue-800">{{ last_30_days }}</p>
            </div>

            <div class="bg-purple-50 border-l-4 border-purple-300 p-6 rounded">
                <h4 class="text-lg font-semibold text-purple-900 mb-2">Last 90 Days</h4>
                <p class="text-3xl font-bold text-purple-800">{{ last_90_days }}</p>
            </div>
        </div>

        <!-- Breakdown by Instrument and Cane Brand -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Instrument Breakdown -->
            <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold text-gray-900 mb-4">Reeds by Instrument</h4>
                {% if instrument_stats %}
                    <div class="space-y-2">
                        {% for stat in instrument_stats %}
                            <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0">
                                <span class="font-medium">{{ stat.instrument|default:"Not specified" }}</span>
                                <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm">{{ stat.count }} reeds</span>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500">No instrument data available</p>
                {% endif %}
            </div>

            <!-- Cane Brand Breakdown -->
            <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold text-gray-900 mb-4">Reeds by Cane Brand</h4>
                {% if cane_brand_stats %}
                    <div class="space-y-2">
                        {% for stat in cane_brand_stats|slice:":10" %}
                            <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0">
                                <span class="font-medium">{{ stat.cane_brand|default:"Not specified" }}</span>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">{{ stat.count }} reeds</span>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500">No cane brand data available</p>
                {% endif %}
            </div>
        </div>

        <!-- Average Quality Metrics -->
        {% if quality_metrics.avg_playing_ease or quality_metrics.avg_intonation or quality_metrics.avg_response %}
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border-l-4 border-indigo-400">
            <h4 class="font-semibold text-indigo-900 mb-4">Average Quality Metrics</h4>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                {% if quality_metrics.avg_playing_ease %}
                <div class="text-center">
                    <p class="text-sm text-indigo-700 mb-1">Playing Ease</p>
                    <p class="text-2xl font-bold text-indigo-800">{{ quality_metrics.avg_playing_ease|floatformat:1 }}/10</p>
                </div>
                {% endif %}
                {% if quality_metrics.avg_intonation %}
                <div class="text-center">
                    <p class="text-sm text-indigo-700 mb-1">Intonation</p>
                    <p class="text-2xl font-bold text-indigo-800">{{ quality_metrics.avg_intonation|floatformat:1 }}/10</p>
                </div>
                {% endif %}
                {% if quality_metrics.avg_response %}
                <div class="text-center">
                    <p class="text-sm text-indigo-700 mb-1">Response</p>
                    <p class="text-2xl font-bold text-indigo-800">{{ quality_metrics.avg_response|floatformat:1 }}/10</p>
                </div>
                {% endif %}
                {% if quality_metrics.avg_global_quality_first %}
                <div class="text-center">
                    <p class="text-sm text-indigo-700 mb-1">Global Quality (1st)</p>
                    <p class="text-2xl font-bold text-indigo-800">{{ quality_metrics.avg_global_quality_first|floatformat:1 }}/10</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Recent Activity -->
    <div class="mb-8">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">Recent Activity (Last 100 Reeds)</h3>

        {% if recent_reeds %}
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-indigo-100 text-indigo-900 font-semibold">
                            <th class="border px-4 py-2 text-left">Reed ID</th>
                            <th class="border px-4 py-2 text-left">Date</th>
                            <th class="border px-4 py-2 text-left">Instrument</th>
                            <th class="border px-4 py-2 text-left">Cane Brand</th>
                            <th class="border px-4 py-2 text-center">Quality</th>
                            <th class="border px-4 py-2 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reed in recent_reeds %}
                        <tr class="border hover:bg-gray-50">
                            <td class="border px-4 py-2 font-medium">{{ reed.reed_ID }}</td>
                            <td class="border px-4 py-2">{{ reed.date|date:"Y-m-d" }}</td>
                            <td class="border px-4 py-2">{{ reed.instrument|default:"—" }}</td>
                            <td class="border px-4 py-2">{{ reed.cane_brand|default:"—" }}</td>
                            <td class="border px-4 py-2 text-center">
                                {% if reed.global_quality_first_impression %}
                                    <span class="{% if reed.global_quality_first_impression >= 7 %}text-green-600 font-semibold{% elif reed.global_quality_first_impression >= 5 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                        {{ reed.global_quality_first_impression }}/10
                                    </span>
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td class="border px-4 py-2 text-center">
                                <a href="{% url 'reeds:edit_reedsdata' reed.id %}"
                                   class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 text-sm">
                                    Edit
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <p class="text-yellow-700">No reeds found. Start by adding your first reed!</p>
            </div>
        {% endif %}
    </div>

    <!-- Quick Links -->
    <div class="flex justify-center gap-4">
        <a href="{% url 'reeds:add' %}"
           class="bg-indigo-800 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-900 transition-all">
            Add New Reed
        </a>
        <a href="{% url 'account:statistics' %}"
           class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-all">
            View Detailed Insights
        </a>
        <a href="{% url 'reeds:reedsdata_list' %}"
           class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all">
            View All Reeds
        </a>
    </div>
</div>

{% endblock content %}
