{% extends 'base.html' %}
{% load widget_tweaks %}
{% block title %}Data Entry{% endblock title %}
{% block content %}

<div class="bg-white rounded-xl shadow-2xl p-8">
    <h2 class="text-2xl font-bold text-center text-indigo-800 mb-6">Single Data Entry</h2>

        <form action="" method="POST" id="registrationForm" class="space-y-3">
            {% csrf_token %}
            
            <!-- Dynamic grid based on number of fields - responsive columns -->
            {% with field_count=form.visible_fields|length %}
                {% if field_count <= 2 %}
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:gap-5 lg:gap-6">
                {% elif field_count <= 4 %}
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:gap-5 lg:gap-6">
                {% elif field_count <= 6 %}
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:gap-5 lg:gap-6">
                {% elif field_count <= 8 %}
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:gap-5 lg:gap-6">
                {% else %}
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:gap-5 lg:gap-6">
                {% endif %}
            {% endwith %}

                {% for field in form %}
                  {% if field.name == 'm1' %}
                    <div class="space-y-1 p-1 min-w-0">
                      <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-indigo-900 truncate">Dry Mass</label>
                      {{ field|add_class:"w-full max-w-full px-2 py-1.5 text-sm border border-gray-200 rounded focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" }}
                    </div>
                  {% elif field.name == 'm2' %}
                    <div class="space-y-1 p-1 min-w-0">
                      <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-indigo-900 truncate">Wet Mass</label>
                      {{ field|add_class:"w-full max-w-full px-2 py-1.5 text-sm border border-gray-200 rounded focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" }}
                    </div>
                    <div class="space-y-1 p-1 min-w-0">
                      <label for="id_density_auto_display" class="block text-sm font-medium text-indigo-900 truncate">Calculated Density</label>
                      {{ form.density_auto_display|add_class:"w-full max-w-full px-2 py-1.5 text-sm border border-gray-200 rounded bg-gray-50 text-gray-600" }}
                    </div>
                  {% elif field.name == 'cane_brand' %}
                    <div class="space-y-1 p-1 min-w-0 relative">
                      <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-indigo-900 truncate">{{ field.label }}</label>
                      <div id="cane-brand-container" class="relative">
                        {{ field|add_class:"w-full max-w-full px-2 py-1.5 text-sm border border-gray-200 rounded focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" }}
                        <!-- Tooltip for Cane Brand -->
                        <div id="cane-brand-tooltip" class="absolute left-0 bottom-full mb-2 w-80 p-4 bg-white text-indigo-800 text-sm shadow-xl rounded-lg border border-indigo-200 z-[9998] opacity-0 invisible transition-all duration-300 pointer-events-none">
                          <h3 class="font-bold mb-2 text-indigo-900">Can't find your cane maker?</h3>
                          <p class="mb-2">If you cannot find your cane maker in the list, please <a href="{% url 'contact:contact' %}" class="text-indigo-600 underline hover:text-indigo-800">contact us</a>, and we will immediately add the cane maker's name to our database.</p>
                        </div>
                      </div>
                    </div>
                  {% elif field.name != 'density_auto_display' %}
                    <div class="space-y-1 p-1 min-w-0">
                      <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-indigo-900 truncate">{{ field.label }}</label>
                      {{ field|add_class:"w-full max-w-full px-2 py-1.5 text-sm border border-gray-200 rounded focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" }}
                    </div>
                  {% endif %}
                {% endfor %}
                
            </div> <!-- Close dynamic grid -->



            <!-- Submit button with better sizing -->
            <div class="flex justify-center mt-8">
                <button type="submit" class="w-full max-w-md bg-indigo-800 text-white py-3 px-8 rounded-lg font-semibold hover:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-indigo-800 focus:ring-offset-2 transition-all duration-300 transform hover:scale-[1.02]">
                    Submit Reed Data
                </button>
            </div>
        </form>
</div>

<!-- Add bottom spacing for comfortable scrolling -->
<div class="h-20"></div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const m1 = document.getElementById("id_m1");
    const m2 = document.getElementById("id_m2");
    const autoDensity = document.getElementById("id_density_auto_display");

    function updateDensity() {
      const m1Val = parseFloat(m1?.value);
      const m2Val = parseFloat(m2?.value);
      if (!isNaN(m1Val) && !isNaN(m2Val) && m1Val + m2Val !== 0) {
        autoDensity.value = (m1Val / (m1Val + m2Val)).toFixed(4);
      } else {
        autoDensity.value = "";
      }
    }

    if (m1 && m2 && autoDensity) {
      m1.addEventListener("input", updateDensity);
      m2.addEventListener("input", updateDensity);
    }
  });
  
  // Cane Brand tooltip functionality
  const caneBrandContainer = document.getElementById("cane-brand-container");
  const caneBrandTooltip = document.getElementById("cane-brand-tooltip");
  let hoverTimeout;
  
  if (caneBrandContainer && caneBrandTooltip) {
    caneBrandContainer.addEventListener("mouseenter", function() {
      // Start 6-second timer
      hoverTimeout = setTimeout(function() {
        caneBrandTooltip.classList.remove("opacity-0", "invisible");
        caneBrandTooltip.classList.add("opacity-100", "visible");
      }, 6000); // 6 seconds
    });
    
    caneBrandContainer.addEventListener("mouseleave", function() {
      // Clear timer and hide tooltip
      clearTimeout(hoverTimeout);
      caneBrandTooltip.classList.add("opacity-0", "invisible");
      caneBrandTooltip.classList.remove("opacity-100", "visible");
    });
  }
  
</script>

{% endblock content %}
